/*! Check-ins 2018-11-04 */
var CheckinMap,CheckinMarker;$(function(){function a(d,e){$("#geoplaceholder").hide(),$("#geofields").slideDown();var f=L.map("checkinMap").setView([d,e],15),g=new L.StamenTileLayer("toner-lite");f.addLayer(g);var h=L.marker([d,e],{dragging:!0});CheckinMap=f,CheckinMarker=h,h.addTo(f),h.dragging.enable(),$("#lat").val(d.toString()),$("#long").val(e.toString()),h.on("dragend",function(a){var c=a.target.getLatLng();console.log(c),$("#lat").val(c.lat.toString()),$("#long").val(c.lng.toString()),b(c.lat,c.lng)}),$("#user_address").change(function(){c($("#user_address").val(),function(){f.remove(),a($("#lat").val(),$("#long").val())})})}function b(a,b,c){$.ajax({url:wwwroot()+"service/geo/geocoder/",data:{lat:a.toString(),long:b.toString()}}).done(function(d){console.log(d),$("#lat").val(a),$("#long").val(b),$("#placename").val(d.name),$("#address").val(d.display_name),$("#user_address").val(d.display_name),c&&c()})}function c(a,b){$.get(wwwroot()+"service/geo/geocoder/",{address:a.toString()}).done(function(a){console.log(a),$("#lat").val(a.latitude),$("#long").val(a.longitude),$("#placename").val(a.name),$("#address").val(a.display_name),$("#user_address").val(a.display_name),b&&b()})}function d(c){var d=c.coords.latitude,e=c.coords.longitude;b(d,e,a.bind(this,d,e))}function e(b){addErrorMessage(b.message),a("51.478791","-0.01068")}var f=$("#lat").val(),g=$("#long").val();f&&g?a(f,g):navigator.geolocation?navigator.geolocation.getCurrentPosition(d,e,{enableHighAccuracy:!0,timeout:1e4}):$("#geoplaceholder").html("<p>Oh no! It looks like your browser does not support geolocation.</p>")});