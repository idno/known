"use strict";function Template(){}Template.addMessage=function(b,a){if(a===undefined){a="alert-info"}if(b!==undefined){$("div#page-messages").append('<div class="alert '+a+' col-md-10 col-md-offset-1"><button type="button" class="close" data-dismiss="alert">&times;</button>'+b+"</div>")}};Template.addErrorMessage=function(a){Template.addMessage(a,"alert-danger")};function addMessage(b,a){Template.addMessage(b)}function addErrorMessage(a){Template.addErrorMessage(a)}Template.activateStarToggle=function(){$(".interactions .annotate-icon a.stars-toggle").each(function(){var b=$(this).attr("data-form-id");var c=$(this).find("i.fa");var a=c.closest("span.annotate-icon").find("a.stars");$("#"+b).submit(function(d){d.preventDefault();$.ajax({type:"POST",url:$(this).attr("action"),data:$(this).serialize(),success:function(e){if(c.hasClass("fa-star-o")){c.removeClass("fa-star-o").addClass("fa-star")}else{c.removeClass("fa-star").addClass("fa-star-o")}a.text(e.text)}})})})};Template.enableFormCandy=function(){$(".ctrl-enter-submit").keypress(function(a){var b=(a.which?a.which:a.keyCode);if((b==10||b==13)&&a.ctrlKey){$(this).closest("form").submit()}})};Template.enablePagination=function(){$(".pager-xhr a").click(function(j){j.preventDefault();var b=$(this).closest(".pager-xhr");var d=parseInt(b.attr("data-offset"));var c=parseInt(b.attr("data-limit"));var i=parseInt(b.attr("data-count"));var f=$("#"+b.attr("data-control-id"));var a=b.attr("data-source-url");var k=$(this).attr("rel");var h=$(this).closest(".pager-xhr").find("li.newer");var l=$(this).closest(".pager-xhr").find("li.older");a=a.split("?")[0];var g;if(k=="next"){g=d-c;if(g<0){g=0}}else{g=d+c;if(g>(i-1)){g=i-1}}a=a+"?offset="+g.toString()+"&limit="+c.toString();f.load(a,function(m,e,n){if(e!="error"){b.attr("data-offset",g.toString());h.removeClass("pagination-disabled");l.removeClass("pagination-disabled");if(g==0){h.addClass("pagination-disabled")}if(g>i-c){l.addClass("pagination-disabled")}f.scrollTop(0)}})})};Template.enableRichTextRequired=function(){$("textarea.validation-required").each(function(){var b=$(this).closest("form");var a=$(this);var c=$(this).closest("div.richtext-container").find("div.alert");b.submit(function(d){c.hide();if(a.val().length==0){d.preventDefault();console.error("Required richtext field "+a.attr("name")+" is blank, preventing form submission");c.show().focus()}})})};Template.enableImageFallback=function(){$("img").on("error",function(){console.error("Loading fallback image "+known.config.displayUrl+"gfx/users/default.png");$(this).attr("src",known.config.displayUrl+"gfx/users/default.png")})};Template.activateImagePreview=function(d){var b=$(d).closest("div.image-file-input").find("div.photo-preview");var e=$(d).closest("div.image-file-input").find("span.photo-filename");var c=$(d).closest("div.image-file-input").find(".preview");if(d.files&&d.files[0]){var a=new FileReader();a.onload=function(h){e.html(e.attr("data-nexttext"));try{var g=EXIF.readFromBinaryFile(base64ToArrayBuffer(this.result));ImageTools.exifRotateImg("#"+c.attr("id"),g.Orientation,"#"+b.attr("id"))}catch(f){console.error(f)}c.attr("src",h.target.result);c.show()};a.readAsDataURL(d.files[0])}};Template.autoSave=function(c,d,b){var a={};setInterval(function(){var j={};for(var g=0;g<d.length;g++){var f=d[g];var e="#"+f;if(b&&f in b){e=b[f]}var h=false;if($(e).val()!=a[f]){h=$(e).val()}if(h!==false){j[f]=h;a[f]=h}}if(Object.keys(j).length>0){$.post(wwwroot()+"autosave/",{context:c,elements:j,names:d},function(){})}},10000)};Template.isCreateFormVisible=false;Template.bindControls=function(){$(".acl-ctrl-option").click(function(){$("#access-control-id").val($(this).attr("data-acl"));$("#acl-text").html($(this).html())});$(".syndication-toggle input[type=checkbox]").bootstrapToggle();$(".ignore-this").hide();Security.activateACLControls();Template.enableFormCandy();Template.enableRichTextRequired();$("#contentCreate .form-control").first().focus()};function bindControls(){Template.bindControls()}Template.initContentCreateForm=function(a,b){if(Template.isCreateFormVisible){return}Template.isCreateFormVisible=true;$.ajax(b,{dataType:"html",success:function(c){$("#contentCreate").html(c).slideDown(400);$("#contentTypeButtonBar").slideUp(400);window.contentCreateType=a;window.contentPage=true;bindControls()},error:function(c){$("#contentTypeButtonBar").slideDown(400);Template.isCreateFormVisible=false}})};function contentCreateForm(a,b){Template.initContentCreateForm(a,b)}Template.hideContentCreateForm=function(){Template.isCreateFormVisible=false;if(window.contentPage==true){$("#contentTypeButtonBar").slideDown(200);$("#contentCreate").slideUp(200)}else{if(window.history.length>1){window.history.back()}}};function hideContentCreateForm(){Template.hideContentCreateForm()}function autoSave(b,c,a){return Template.autoSave(b,c,a)}function annotateContent(){$(".h-entry").fitVids();$("time.dt-published").timeago()}$(document).ready(function(){$.timeago.settings.cutoff=30*24*60*60*1000;annotateContent();Template.activateStarToggle()});(function(a,c,d){if((d in c)&&c[d]){var f,b=a.location,e=/^(a|html)$/i;a.addEventListener("click",function(g){f=g.target;while(!(e).test(f.nodeName)){f=f.parentNode}if("href" in f&&(f.href.indexOf("http")||~f.href.indexOf(b.host))&&(!f.classList.contains("contentTypeButton"))){g.preventDefault();b.href=f.href}},false)}})(document,window.navigator,"standalone");$(document).ready(function(){$("body").on("click",function(c,b){var a=c.target;if(a.href&&a.href.indexOf(window.location.origin)===-1){a.target="_blank"}})});$(document).ready(function(){Template.enableFormCandy();Template.enablePagination();Template.enableRichTextRequired();Template.enableImageFallback()});